<?php/* Tento súbor slúži na obsluhu pridania/opravy položiek slider-u   Zmena: 21.07.2011 - PV*/// Hlavička stránkyif (@$bzpkod<>1934572) exit("Neoprávnený prístup!!!");  // Bezpečnostný kódecho("<h2>Pridanie/Oprava položiek slider-u</h2><br />");//Inicializácia premených $id_polozka=0;   $popis="";     //Popis obrázku $subor=0;      //Názov súboru aj s relatívnou cestou $zobrazenie="";//Kde sa zobrazuje obrázok $vysledok="";  //Výsledok zápisu do DB   /*-------- Časť zápisu do databázy    ---------- */ function pridaj_slider() /* Funkcia zapíše položku slideru do databázy.     Vstupy: - hodnoty prichádzajú cez $_POST z formulára	 Výstupy: ok-ak všetko prebehlo správne inak chybová hláška	 Obmedzenie: Zatiaľ neznáme.	 Zmena: 16.06.2011 - PV  */{if ($_REQUEST["zobrazenie"]=="") $zobrazenie=NULL; else $zobrazenie=$_REQUEST["zobrazenie"]; $pridanie_slideru=mysql_query("INSERT INTO slider (id_polozka, popis, subor, zobrazenie) VALUES(".$_REQUEST["id_polozka"].", '".$_REQUEST["popis"]."', '".$_REQUEST["subor"]."', '$zobrazenie')");if (!$pridanie_slideru) return mysql_error();return "ok";}function oprav_slider() /* Funkcia aktualizuje položku slideru v databáze.     Vstupy: - hodnoty prichádzajú cez $_POST z formulára	 Výstupy: ok-ak všetko prebehlo správne inak chybová hláška	 Obmedzenie: Zatiaľ neznáme.	 Zmena: 16.06.2011 - PV  */{if ($_REQUEST["zobrazenie"]=="") $zobrazenie=NULL; else $zobrazenie=$_REQUEST["zobrazenie"]; $oprava_slideru=mysql_query("UPDATE slider SET id_polozka=".$_REQUEST["id_polozka"].", popis='".$_REQUEST["popis"]."', subor='".$_REQUEST["subor"]."', zobrazenie='$zobrazenie'                             WHERE id_polozka=".$_REQUEST["id_polozka"]." LIMIT 1");if (!$oprava_slideru) return mysql_error();return "ok";}function vymaz_slider()  /* Funkcia vymaže položku slideru z databázy.     Vstupy: - hodnoty prichádzajú cez $_REQUEST z formulára	 Výstupy: ok-ak všetko prebehlo správne inak chybová hláška	 Obmedzenie: Zatiaľ neznáme.	 Zmena: 16.06.2011 - PV  */ {$vymaz_slideru=prikaz_sql("DELETE FROM slider WHERE id_polozka=".$_REQUEST["id_slider"],                          "Zmazanie položky (".__FILE__ ." on line ".__LINE__ .")","Záznam nebol vymazaný! Niektorý údaj bol zadaný chybne alebo nebolo možné uskutočniť spojenie s databázou!");if (!$vymaz_slideru) return mysql_error();return "ok";}  /* --- Pridanie/Oprava položky menu akcie ak bola daná požiadavka --- */if (@$_REQUEST["slider"]=="Pridaj")    $vysledok=pridaj_slider();elseif (@$_REQUEST["slider"]=="Oprav") $vysledok=oprav_slider();elseif (@$_REQUEST["slider"]=="Áno")   $vysledok=vymaz_slider();if (@$zobr_co=="adm_del_slider" AND @$vysledok<>"ok") { // vymazanie položky sub. menu $vys_sub=prikaz_sql("SELECT * FROM slider WHERE id_polozka=".$_REQUEST["id"]." LIMIT 1",                     "Nájdenie položky(".__FILE__ ." on line ".__LINE__ .")","Žiaľ sa momentálne nepodarilo nájsť položku a teda ani vymazať! Skúste neskôr."); if (@$vys_sub) {  $zaz_sub=mysql_fetch_array($vys_sub);  echo("\n<div class=st_zle>Vymazanie položky slideru !!!<br />");  echo("Naozaj chceš vymazať položku <B><U>$zaz_sub[popis]</U></B>!!!");  echo("\n<form action=\"index.php?clanok=$zobr_clanok&amp;id_clanok=$zobr_pol\" method=post>");  echo("\n<input name=\"id_slider\" type=\"hidden\" value=\"$zaz_sub[id_polozka]\">");  echo("\n<input name=\"slider\" type=\"submit\" value=\"Áno\">");  echo("\n<input name=\"slider\" type=\"submit\" value=\"Nie\"></form></div>\n"); }}else {  /* ----------- Časť spracovania formulára ---------- */if ($vysledok<>"") { // Zapisovalo sa do databázy  if ($vysledok<>"ok") {  // Načítanie údajov po chybnom zápise do databázy    stav_zle("Záznam nebol pridaný. Niektorý údaj bol zadaný chybne alebo nebolo možné uskutočniť spojenie s databázou!:<br>$vysledok");    $id_polozka=$_REQUEST["id_polozka"];  // Opätovné načítanie údajou ak došlo k chybe    $popis=$_REQUEST["popis"];	$subor=$_REQUEST["subor"];	$zobrazenie=$_REQUEST["zobrazenie"];  }  else {                // Správny zápis aktualizácie do DB    echo("<div class=st_dobre>Položka slideru bola ");  //Vypísanie info o operácii    if (@$_REQUEST[menu_akcia]=="Pridaj") echo("pridaná!");       elseif(@$_REQUEST[menu_akcia]=="Oprav") echo("opravená!");    else echo("zmenená!");    echo("&nbsp;Zmena sa prejaví až po kliknutí na položku v hlavnom menu.</div>");  }}  echo("<form name=\"zadanie\" action=\"./index.php?clanok=$zobr_clanok&amp;id_clanok=$zobr_pol\" method=post>"); // Začiatok formulára pre zadanie údajovif (@(int)$_REQUEST["id"]>0){ //Ak prišiel údaj o požiadavke na editáciu položky tak sa položka nájde v databáze a načíta do premených  $navrat_e=prikaz_sql("SELECT * FROM slider WHERE id_polozka=".$_REQUEST["id"]." LIMIT 1",                       "Načítanie položky slideru (".__FILE__ ." on line ".__LINE__ .")","Žiaľ sa momentálne nepodarilo položku nájsť! Skúste neskôr.");  if ($navrat_e) { //Ak bola požiadavka do DB úspečná   $zaz_e = mysql_fetch_array($navrat_e);   $id_polozka=$zaz_e["id_polozka"];   $popis=$zaz_e["popis"];   $subor=$zaz_e["subor"];   $zobrazenie=$zaz_e["zobrazenie"];  }}echo("<div id=admin><fieldset>");  //Samotny formular na zadanieform_pole("id_polozka","Index",$id_polozka,"POZOR! táto položka určuje poradie ale NESMIE sa opakovať!!!", 5);form_pole("popis","Popis obrázku",$popis,"", 80,50);form_pole("subor","Názov obrázku",$subor,"Názov súboru sa zadáva aj s relatívnou cestou. napr. slider/obrazok.jpg", 50);form_pole("zobrazenie","Zobrazenie",$zobrazenie,          "V ktorých častiach hlavného menu sa má daný obrázok zobraziť. Jednotlivé časti sa píšu ako čísla(v odkaze číslo za clanok=) oddelené medzerami.", 20);echo("<input name=slider type=\"submit\" value=\"");echo(@$_REQUEST["id"]<>"" ? "Oprav" : "Pridaj");echo("\"></fieldset></form></div>");  /* ----- Výpis všetkých položiek hl. menu ----- */$navrat=prikaz_sql("SELECT * FROM slider ORDER BY id_polozka",                   "Výpis položiek slideru (".__FILE__ ." on line ".__LINE__ .")","Žiaľ sa momentálne nepodarilo zoznam vypísať! Skúste neskôr."); if ($navrat) { //Ak bola požiadavka do DB úspečná  echo("<table id=vyp_adm cellpadding=2 cellspacing=0>"); //Výpis položiek menu  echo("<tr><th>Id</th><th>Popis</th><th>Súbor</th><th>Zobrazenie</th><th colspan=2></th></tr>");  $pom=true;  while ($polozka = mysql_fetch_array($navrat)){     echo($pom ? "<tr class=r1>" : "<tr class=r2>");    if ($pom) $pom=false; else $pom=true;     echo("<td>$polozka[id_polozka]</td><td>$polozka[popis]</td><td>$polozka[subor]</td><td>");	echo(($polozka["zobrazenie"]=="" OR $polozka["zobrazenie"]==NULL) ? "Všade" : "$polozka[zobrazenie]");    echo("</td><td><a href=\"index.php?clanok=$zobr_clanok&amp;id_clanok=$zobr_pol&amp;id=$polozka[id_polozka]&amp;co=adm_edit_slider\" class=edit title=\"Editácia položky $polozka[popis]\">"); //Odkaz na editáciu    echo("&nbsp;&nbsp;&nbsp;&nbsp;</a></td><td>         <a href=\"index.php?clanok=$zobr_clanok&amp;id_clanok=$zobr_pol&amp;id=$polozka[id_polozka]&amp;co=adm_del_slider\" class=vymaz title=\"Vymazanie položky $polozka[popis]\">&nbsp;&nbsp;&nbsp;&nbsp;</a>         </td>	</tr>");  }  echo("</table>");}  }?>